{"ast":null,"code":"import { SELECT_SUBREDDIT, INVALIDATE_SUBREDDIT, REQUEST_POSTS, RECEIVE_POSTS } from '../constants'; // Import fetch API in case of browser compatiblity issues\n\nimport fetch from 'cross-fetch'; // Action creators for all functionality\n// Basically wraps up type and subreddit selected into an object\n\nexport var selectSubreddit = function selectSubreddit(subreddit) {\n  return {\n    type: SELECT_SUBREDDIT,\n    subreddit: subreddit\n  };\n};\nexport var selectSort = function selectSort(sort) {\n  return {\n    type: SELECT_SORT,\n    sort: sort\n  };\n};\nexport var invalidateSubreddit = function invalidateSubreddit(subreddit) {\n  return {\n    type: INVALIDATE_SUBREDDIT,\n    subreddit: subreddit\n  };\n};\n\nvar requestPosts = function requestPosts(subreddit) {\n  return {\n    type: REQUEST_POSTS,\n    subreddit: subreddit\n  };\n};\n\nvar recievePosts = function recievePosts(subreddit, json) {\n  return {\n    type: RECEIVE_POSTS,\n    subreddit: subreddit,\n    posts: json.data.children.map(function (child) {\n      return child.data;\n    }),\n    recievedAt: Date.now()\n  };\n}; // Helper function to fetch JSON data from Reddit API\n\n\nvar fetchPosts = function fetchPosts(subreddit) {\n  return function (dispatch) {\n    // Dispatch requestPosts action just before attempting to fetching data\n    dispatch(requestPosts(subreddit)); // Fetch data and dispatch recievePosts if no errors\n    // Catch shouldn't be used to handle errors as\n\n    return fetch(\"https://www.reddit.com/\".concat(subreddit, \".json\")).then(function (response) {\n      return response.json();\n    }, function (error) {\n      return console.log('An error occured', error);\n    }).then(function (json) {\n      return dispatch(recievePosts(subreddit, json));\n    });\n  };\n};\n\nvar shouldFetchPosts = function shouldFetchPosts(state, subreddit) {\n  // Get posts by subreddit from state\n  var posts = state.postsBySubreddit[subreddit]; // Should fetch posts if no posts exists and not fetching already\n  // If posts exists and not fetching then depends on if posts have invalidated\n\n  if (!posts) {\n    return true;\n  } else if (posts.isFetching) {\n    return false;\n  } else {\n    return posts.didInvalidate;\n  }\n};\n\nexport var fetchPostsIfNeeded = function fetchPostsIfNeeded(subreddit) {\n  return function (dispatch, getState) {\n    if (shouldFetchPosts(getState(), subreddit)) {\n      return dispatch(fetchPosts(subreddit));\n    }\n  };\n};","map":{"version":3,"sources":["/Users/joga/Documents/Pooja/reddit-replica/src/actions/actions.js"],"names":["SELECT_SUBREDDIT","INVALIDATE_SUBREDDIT","REQUEST_POSTS","RECEIVE_POSTS","fetch","selectSubreddit","subreddit","type","selectSort","sort","SELECT_SORT","invalidateSubreddit","requestPosts","recievePosts","json","posts","data","children","map","child","recievedAt","Date","now","fetchPosts","dispatch","then","response","error","console","log","shouldFetchPosts","state","postsBySubreddit","isFetching","didInvalidate","fetchPostsIfNeeded","getState"],"mappings":"AAAA,SACIA,gBADJ,EAEIC,oBAFJ,EAGIC,aAHJ,EAIIC,aAJJ,QAKO,cALP,C,CAOA;;AACA,OAAOC,KAAP,MAAkB,aAAlB,C,CAEA;AACA;;AAEA,OAAO,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,SAAD;AAAA,SAC3B;AACIC,IAAAA,IAAI,EAAEP,gBADV;AAEIM,IAAAA,SAAS,EAATA;AAFJ,GAD2B;AAAA,CAAxB;AAOP,OAAO,IAAME,UAAU,GAAG,SAAbA,UAAa,CAACC,IAAD;AAAA,SACtB;AACIF,IAAAA,IAAI,EAAEG,WADV;AAEID,IAAAA,IAAI,EAAJA;AAFJ,GADsB;AAAA,CAAnB;AAOP,OAAO,IAAME,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACL,SAAD;AAAA,SAC/B;AACIC,IAAAA,IAAI,EAAEN,oBADV;AAEIK,IAAAA,SAAS,EAATA;AAFJ,GAD+B;AAAA,CAA5B;;AAOP,IAAMM,YAAY,GAAG,SAAfA,YAAe,CAACN,SAAD;AAAA,SACjB;AACIC,IAAAA,IAAI,EAAEL,aADV;AAEII,IAAAA,SAAS,EAATA;AAFJ,GADiB;AAAA,CAArB;;AAOA,IAAMO,YAAY,GAAG,SAAfA,YAAe,CAACP,SAAD,EAAYQ,IAAZ;AAAA,SACjB;AACIP,IAAAA,IAAI,EAAEJ,aADV;AAEIG,IAAAA,SAAS,EAATA,SAFJ;AAGIS,IAAAA,KAAK,EAAED,IAAI,CAACE,IAAL,CAAUC,QAAV,CAAmBC,GAAnB,CAAuB,UAAAC,KAAK;AAAA,aAAIA,KAAK,CAACH,IAAV;AAAA,KAA5B,CAHX;AAIII,IAAAA,UAAU,EAAEC,IAAI,CAACC,GAAL;AAJhB,GADiB;AAAA,CAArB,C,CASA;;;AACA,IAAMC,UAAU,GAAG,SAAbA,UAAa,CAACjB,SAAD,EAAe;AAC9B,SAAO,UAACkB,QAAD,EAAc;AACjB;AACAA,IAAAA,QAAQ,CAACZ,YAAY,CAACN,SAAD,CAAb,CAAR,CAFiB,CAIjB;AACA;;AACA,WAAOF,KAAK,kCAA2BE,SAA3B,WAAL,CACFmB,IADE,CAEC,UAAAC,QAAQ;AAAA,aAAIA,QAAQ,CAACZ,IAAT,EAAJ;AAAA,KAFT,EAGC,UAAAa,KAAK;AAAA,aAAIC,OAAO,CAACC,GAAR,CAAY,kBAAZ,EAAgCF,KAAhC,CAAJ;AAAA,KAHN,EAKFF,IALE,CAMC,UAAAX,IAAI;AAAA,aAAIU,QAAQ,CAACX,YAAY,CAACP,SAAD,EAAYQ,IAAZ,CAAb,CAAZ;AAAA,KANL,CAAP;AAQH,GAdD;AAeH,CAhBD;;AAkBA,IAAMgB,gBAAgB,GAAG,SAAnBA,gBAAmB,CAACC,KAAD,EAAQzB,SAAR,EAAsB;AAC3C;AACA,MAAMS,KAAK,GAAGgB,KAAK,CAACC,gBAAN,CAAuB1B,SAAvB,CAAd,CAF2C,CAI3C;AACA;;AACA,MAAI,CAACS,KAAL,EAAY;AACR,WAAO,IAAP;AACH,GAFD,MAEO,IAAIA,KAAK,CAACkB,UAAV,EAAsB;AACzB,WAAO,KAAP;AACH,GAFM,MAEA;AACH,WAAOlB,KAAK,CAACmB,aAAb;AACH;AACJ,CAbD;;AAeA,OAAO,IAAMC,kBAAkB,GAAG,SAArBA,kBAAqB,CAAC7B,SAAD,EAAe;AAC7C,SAAO,UAACkB,QAAD,EAAWY,QAAX,EAAwB;AAC3B,QAAIN,gBAAgB,CAACM,QAAQ,EAAT,EAAa9B,SAAb,CAApB,EAA6C;AACzC,aAAOkB,QAAQ,CAACD,UAAU,CAACjB,SAAD,CAAX,CAAf;AACH;AACJ,GAJD;AAKH,CANM","sourcesContent":["import {\n    SELECT_SUBREDDIT,\n    INVALIDATE_SUBREDDIT,\n    REQUEST_POSTS,\n    RECEIVE_POSTS\n} from '../constants'\n\n// Import fetch API in case of browser compatiblity issues\nimport fetch from 'cross-fetch'\n\n// Action creators for all functionality\n// Basically wraps up type and subreddit selected into an object\n\nexport const selectSubreddit = (subreddit) => (\n    {\n        type: SELECT_SUBREDDIT,\n        subreddit\n    }\n)\n\nexport const selectSort = (sort) => (\n    {\n        type: SELECT_SORT,\n        sort\n    }\n)\n\nexport const invalidateSubreddit = (subreddit) => (\n    {\n        type: INVALIDATE_SUBREDDIT,\n        subreddit\n    }\n)\n\nconst requestPosts = (subreddit) => (\n    {\n        type: REQUEST_POSTS,\n        subreddit\n    }\n)\n\nconst recievePosts = (subreddit, json) => (\n    {\n        type: RECEIVE_POSTS,\n        subreddit,\n        posts: json.data.children.map(child => child.data),\n        recievedAt: Date.now()\n    }\n)\n\n// Helper function to fetch JSON data from Reddit API\nconst fetchPosts = (subreddit) => {\n    return (dispatch) => {\n        // Dispatch requestPosts action just before attempting to fetching data\n        dispatch(requestPosts(subreddit))\n\n        // Fetch data and dispatch recievePosts if no errors\n        // Catch shouldn't be used to handle errors as\n        return fetch(`https://www.reddit.com/${subreddit}.json`)\n            .then(\n                response => response.json(),\n                error => console.log('An error occured', error)\n            )\n            .then(\n                json => dispatch(recievePosts(subreddit, json))\n            )\n    }\n}\n\nconst shouldFetchPosts = (state, subreddit) => {\n    // Get posts by subreddit from state\n    const posts = state.postsBySubreddit[subreddit]\n\n    // Should fetch posts if no posts exists and not fetching already\n    // If posts exists and not fetching then depends on if posts have invalidated\n    if (!posts) {\n        return true\n    } else if (posts.isFetching) {\n        return false\n    } else {\n        return posts.didInvalidate\n    }\n}\n\nexport const fetchPostsIfNeeded = (subreddit) => {\n    return (dispatch, getState) => {\n        if (shouldFetchPosts(getState(), subreddit)) {\n            return dispatch(fetchPosts(subreddit))\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}